<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SnowBridge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Basic PWA-ish niceties (harmless, optional) -->
  <meta name="theme-color" content="#ffffff" />

  <!-- Leaflet (NO integrity during early deploy/debug; avoids silent blocking) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- App styles -->
  <link rel="stylesheet" href="./styles.css" />

  <!-- Safety: map never collapses even if styles.css fails -->
  <style>
    :root { --topbar-h: 52px; }
    #map { height: calc(100vh - var(--topbar-h)); width: 100%; }
    /* Safety: keep suggestions above Leaflet panes */
    #addrSuggest { position: absolute; z-index: 9999; }
  </style>
</head>

<body>
  <!-- TOP BAR : single-line control surface -->
  <div id="topbar">
    <input
      id="addrInput"
      type="text"
      placeholder="Search Waterford address…"
      autocomplete="off"
      inputmode="text"
      aria-label="Search address"
    />

    <button id="addrBtn" type="button" aria-label="Search">Go</button>

    <label class="toggle" title="Toggle between parcel boundary and snow zone (+8m buffer)">
      <input id="modeToggle" type="checkbox" />
      Snow zone
    </label>

    <label class="toggle" title="Toggle satellite imagery (View will mask it to +8m snow zone)">
      <input id="satToggle" type="checkbox" />
      Satellite
    </label>

    <span id="status" aria-live="polite">Loading…</span>
  </div>

  <!-- MAP -->
  <div id="map" role="application" aria-label="Map"></div>

  <!-- Libraries (Leaflet must load BEFORE app.js so global `L` exists) -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- ES module capability shim (kept in this file as requested) -->
  <script>
    (function () {
      try {
        // If Leaflet failed to load, show it immediately (matches app.js hardFail intent)
        if (typeof window.L === "undefined") {
          var s = document.getElementById("status");
          if (s) s.textContent = "Error: Leaflet failed to load. Check network/CSP.";
        }
      } catch (_) {}
    })();
  </script>

  <!-- App logic -->
  <!-- IMPORTANT: this must match your filename in /docs (app.js vs apps.js). -->
  <script type="module" src="./app.js"></script>

  <!-- No-module fallback (older browsers) -->
  <script nomodule>
    (function () {
      var s = document.getElementById("status");
      if (s) s.textContent = "Error: This browser does not support ES modules.";
    })();
  </script>

  <noscript>
    <div style="padding:10px;font-family:system-ui,Arial,sans-serif;">
      SnowBridge needs JavaScript enabled to load the map.
    </div>
  </noscript>
</body>
</html>
